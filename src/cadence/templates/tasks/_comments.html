{% if comments %}
<ul class="comments-list">
    {% for comment in comments %}
    <li class="comment-item">
        <div class="comment-header">
            <strong>{{ users[comment.user_id].display_name or users[comment.user_id].email if comment.user_id in users else 'Unknown' }}</strong>
            <small class="comment-time">{{ comment.created_at|localdatetime }}</small>
            {% if comment.user_id == g.user.id or task.owner_id == g.user.id or g.user.is_admin %}
            <form method="POST"
                  action="{{ url_for('tasks.delete_comment', task_uuid=task.uuid, comment_uuid=comment.uuid) }}"
                  hx-post="{{ url_for('tasks.delete_comment', task_uuid=task.uuid, comment_uuid=comment.uuid) }}"
                  hx-target="#comments-section"
                  hx-swap="innerHTML"
                  style="display: inline;">
                <button type="submit" class="outline secondary comment-delete" onclick="return confirm('Delete this comment?')">Delete</button>
            </form>
            {% endif %}
        </div>
        <div class="comment-content">{{ comment.content }}</div>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No comments yet.</p>
{% endif %}

<form method="POST"
      action="{{ url_for('tasks.add_comment', task_uuid=task.uuid) }}"
      hx-post="{{ url_for('tasks.add_comment', task_uuid=task.uuid) }}"
      hx-target="#comments-section"
      hx-swap="innerHTML"
      class="comment-form">
    <label for="content">
        Add a comment
        <textarea id="content" name="content" rows="3" required></textarea>
    </label>
    <button type="submit">Post Comment</button>
</form>
