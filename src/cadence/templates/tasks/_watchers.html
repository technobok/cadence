<p>
    <strong>Watchers:</strong>
    {% if watcher_count == 0 %}
    <span class="muted">None</span>
    {% else %}
    <span>{{ watcher_count }} {% if watcher_count == 1 %}person{% else %}people{% endif %}</span>
    {% endif %}
</p>

{% if watchers %}
<ul class="watcher-list compact">
    {% for w in watchers %}
    <li>
        {{ w.display_name or w.email }}
        {% if can_manage_watchers and w.id != task.owner_id %}
        <form method="POST"
              action="{{ url_for('tasks.remove_watcher', task_uuid=task.uuid, user_id=w.id) }}"
              hx-post="{{ url_for('tasks.remove_watcher', task_uuid=task.uuid, user_id=w.id) }}"
              hx-target="#watchers-section"
              hx-swap="innerHTML"
              style="display: inline;">
            <button type="submit" class="outline secondary small" title="Remove watcher">&times;</button>
        </form>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% endif %}

{% if can_manage_watchers and available_users %}
<form method="POST"
      action="{{ url_for('tasks.add_watcher', task_uuid=task.uuid) }}"
      hx-post="{{ url_for('tasks.add_watcher', task_uuid=task.uuid) }}"
      hx-target="#watchers-section"
      hx-swap="innerHTML"
      class="add-watcher-form">
    <select name="user_id" required>
        <option value="">Add watcher...</option>
        {% for u in available_users %}
        <option value="{{ u.id }}">{{ u.display_name or u.email }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="outline small">Add</button>
</form>
{% endif %}
