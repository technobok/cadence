{% if tags %}
<table>
    <thead>
        <tr>
            <th>Color</th>
            <th>Name</th>
            <th>Usage</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in tags %}
        <tr>
            <td>
                <span class="tag-badge" style="background: {{ item.tag.color }}"{% if item.tag.is_light() %} data-light="true"{% endif %}>{{ item.tag.name }}</span>
            </td>
            <td>{{ item.tag.name }}</td>
            <td>{{ item.usage_count }} task{% if item.usage_count != 1 %}s{% endif %}</td>
            <td>
                <div class="tag-actions">
                    <a href="{{ url_for('tags.edit', tag_uuid=item.tag.uuid) }}" role="button" class="small outline">Edit</a>
                    {% if item.usage_count == 0 %}
                    <form method="POST" action="{{ url_for('tags.delete', tag_uuid=item.tag.uuid) }}" style="display: inline;">
                        <button type="submit" class="small outline contrast">Delete</button>
                    </form>
                    {% else %}
                    <button type="button" class="small outline contrast" onclick="showDeleteDialog('{{ item.tag.uuid }}', '{{ item.tag.name|e }}', {{ item.usage_count }})">Delete...</button>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Delete confirmation dialog -->
<dialog id="delete-tag-dialog">
    <article>
        <header>
            <button type="button" aria-label="Close" rel="prev" onclick="document.getElementById('delete-tag-dialog').close()"></button>
            <h3>Delete Tag</h3>
        </header>
        <p id="delete-tag-message"></p>
        <form id="delete-tag-form" method="POST">
            <input type="hidden" name="force" value="1">
            <footer class="form-actions">
                <button type="submit" class="contrast">Delete Tag</button>
                <button type="button" class="outline" onclick="document.getElementById('delete-tag-dialog').close()">Cancel</button>
            </footer>
        </form>
    </article>
</dialog>

<script>
function showDeleteDialog(uuid, name, usageCount) {
    var dialog = document.getElementById('delete-tag-dialog');
    var message = document.getElementById('delete-tag-message');
    var form = document.getElementById('delete-tag-form');

    message.textContent = 'Tag "' + name + '" is used by ' + usageCount + ' task(s). Are you sure you want to delete it? This will remove the tag from all tasks.';
    form.action = '/tags/' + uuid + '/delete';

    dialog.showModal();
}
</script>
{% else %}
<p>No tags found.</p>
{% endif %}
